import numpy as np
from astropy.time import Time


def test_airmass(public_source, ztf_camera):
    telescope = ztf_camera.telescope
    times = Time(np.linspace(58000, 59000), format='mjd')
    airmass_calc = public_source.airmass(telescope, times).value
    airmass_true = np.asarray([ -6.98036718, -23.34945066,   4.33830158,
                                -2.48338575,   1.79164625, -1.46739713,
                                1.29212201,  -1.21463384,   1.1982702,
                                -1.25054927, 1.37398973,  -1.62535619,
                                2.10471147,  -3.25644078,   7.86105943,
                                15.88266305,  -4.0640699,   2.37784808,
                                -1.75529466,   1.44122977, -1.28412023,
                                1.20770359,  -1.20303256,   1.25604142,
                                -1.39535264, 1.65378538,  -2.18325969,
                                3.42466782,  -9.32714841, -12.6383515,
                                3.76829161,  -2.30321597,   1.70971305,
                                -1.4248433,    1.27040108, -1.20724861,
                                1.20260285,  -1.26857419,  1.41015268,
                                -1.69554766, 2.24916768,  -3.66721669,
                                10.98339563,  10.0651456,   -3.56390628,
                                2.21394053,  -1.67866853,   1.40139983,
                                -1.26419576,   1.20134104])
    np.testing.assert_allclose(airmass_calc, airmass_true)


def test_altitude(public_source, ztf_camera):
    telescope = ztf_camera.telescope
    times = Time(np.linspace(58000, 59000), format='mjd')
    airmass_calc = public_source.altitude(telescope, times).value
    airmass_true = np.asarray([-8.236471205478335, -2.4545891949233756,
                               13.326802219762435, -23.74557916152537,
                               33.92767084312363, -42.959308181645206,
                               50.70728372038899, -55.41584605114044,
                               56.567587555021746, -53.09656119636098,
                               46.70290093160975, -37.9700704087155,
                               28.367457029348937, -17.883570472982335,
                               7.308359004302709, 3.6098292922763755,
                               -14.244411774446405, 24.869209668119726,
                               -34.72965130147986, 43.93579830565533,
                               -51.14565469192363, 55.89564715643906,
                               -56.225574836441474, 52.76420934533121,
                               -45.77979496074616, 37.20534251455628,
                               -27.26010603174954, 16.977678586727993,
                               -6.154734130046218, -4.538229003092764,
                               15.389072752599379, -25.732842728787002,
                               35.795464613813444, -44.57413579009122,
                               51.92024388077538, -55.927548597147954,
                               56.256198677708994, -52.02567586219354,
                               45.165235761101464, -36.14139378811532,
                               26.39831994573107, -15.824184113158143,
                               5.223815732733556, 5.701900776026573,
                               -16.295480151057205, 26.85173507328798,
                               -36.56327857873727, 45.526309946450226,
                               -52.280628412384736, 56.34639121561762])
    np.testing.assert_allclose(airmass_calc, airmass_true)
